<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pattern Matching • pmatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Pattern Matching">
<meta property="og:description" content="Implements type constructions and pattern matching.
    Using this package, you can specify a type of object and write functions
    that matches against the structure of objects of such types to program
    data structure transformations more succinctly.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">pmatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="articles/getting-started-with-pmatch-.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/getting-started-with-pmatch-.html">Getting Started</a>
    </li>
    <li>
      <a href="articles/huffman-coding.html">Huffman coding</a>
    </li>
    <li>
      <a href="articles/optional-types-with-pmatch.html">Optional types</a>
    </li>
  </ul>
</li>
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/ThomasMailund">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/mailund/pmatch">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="haskell-like-pattern-matching-in-r" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#haskell-like-pattern-matching-in-r" class="anchor"></a>Haskell-like pattern matching in R</h1></div>

<p>The goal of the <code>pmatch</code> package is to provide structure pattern matching, similar to Haskell and ML, to R programmers. The package provide functionality for defining new types and for matching against the structure of such types.</p>
<p>The idea behind pattern matching is that we define types by how we create them, and we have ways of matching a pattern of constructors against a value to pick the one that matches the value.</p>
<p>The simplest example is a type defined just from constants. For example, we can define the type <code>enum</code> to consist of one of <code>ONE</code>, <code>TWO</code>, or <code>THREE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">enum <span class="op">:</span><span class="er">=</span><span class="st"> </span>ONE <span class="op">|</span><span class="st"> </span>TWO <span class="op">|</span><span class="st"> </span>THREE</a></code></pre></div>
<p>Any of these three constants will be created by this command. If you print them, they just give you their names:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ONE</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; ONE</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">TWO</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; TWO</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">THREE</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; THREE</span></a></code></pre></div>
<p>The interesting feature is that we can match against these constructor-constants. Using the <code>case_func</code> function we can declare functions where we can pick a pattern that matches a value.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">elements &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(ONE, TWO, THREE)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">match &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    ONE -&gt;<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    TWO -&gt;<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    THREE -&gt;<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="cf">for</span> (elm <span class="cf">in</span> elements) {</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    value &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/match">match</a></span>(elm)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Element"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/toString">toString</a></span>(elm), <span class="st">"maps to value"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/toString">toString</a></span>(value), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; Element ONE maps to value 1 </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; Element TWO maps to value 2 </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; Element THREE maps to value 3</span></a></code></pre></div>
<p>The <code>case_func</code> function works by matching its first element–which should be a value constructed as a type we have defined with <code>:=</code>–against a list of patterns. The pattern arguments are on the form <code>pattern -&gt; expression</code>. The value is matched against the patterns in turn and the first pattern that matches will be chosen. The expression to the right of the arrow is then evaluated and the result is returned.</p>
<p>The patterns do not need to be literal constants. You can also use variables. These will be bound to the matching value and the expression that is evaluated will see such variables bound.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">elements &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(ONE, TWO, THREE)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">match &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    ONE -&gt;<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    v -&gt;<span class="st"> </span>v</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="cf">for</span> (elm <span class="cf">in</span> elements) {</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    value &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/match">match</a></span>(elm)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Element"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/toString">toString</a></span>(elm), <span class="st">"maps to value"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/toString">toString</a></span>(value), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; Element ONE maps to value 1 </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; Element TWO maps to value TWO </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; Element THREE maps to value THREE</span></a></code></pre></div>
<p>It gets more interesting when we move beyond constants. The <code>:=</code> operator also allows you to define function-constructors. These are written simply as you would write a function call, but the variables are interpreted as parameters of the constructor. For example, we could define:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">zero_one_two_three <span class="op">:</span><span class="er">=</span><span class="st"> </span>ZERO <span class="op">|</span><span class="st"> </span><span class="kw">ONE</span>(x) <span class="op">|</span><span class="st"> </span><span class="kw">TWO</span>(x,y) <span class="op">|</span><span class="st"> </span><span class="kw">THREE</span>(x,y,z)</a></code></pre></div>
<p>The first constructor, <code>ZERO</code>, is just a constant as before, but the other three takes arguments.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ONE</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; ONE(x = 1)</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">TWO</span>(<span class="dv">1</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; TWO(x = 1, y = 2)</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">THREE</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; THREE(x = 1, y = 2, z = 3)</span></a></code></pre></div>
<p>When we use <code>case_func</code> to match against such patterns, we can bind variables to the values they contain.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    ZERO         -&gt;<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    <span class="kw">ONE</span>(x)       -&gt;<span class="st"> </span>x,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="kw">TWO</span>(x,y)     -&gt;<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="kw">THREE</span>(x,y,z) -&gt;<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw">f</span>(ZERO)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw">f</span>(<span class="kw">ONE</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="kw">f</span>(<span class="kw">TWO</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="kw">f</span>(<span class="kw">THREE</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; [1] 6</span></a></code></pre></div>
<p>You can nest these patterns to match on more complex values</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    ZERO               -&gt;<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="kw">ONE</span>(x)             -&gt;<span class="st"> </span>x,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="kw">TWO</span>(<span class="kw">ONE</span>(x),<span class="kw">ONE</span>(y)) -&gt;<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span><span class="dv">42</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="kw">TWO</span>(x,y)           -&gt;<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="kw">THREE</span>(x,y,z)       -&gt;<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw">f</span>(<span class="kw">TWO</span>(<span class="kw">ONE</span>(<span class="dv">10</span>),<span class="kw">ONE</span>(<span class="op">-</span><span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; [1] 42</span></a></code></pre></div>
<p>You have to be careful with the order of expressions, though. If we flipped the two <code>TWO</code> patterns, the first one, <code>TWO(x,y)</code> would match first and we would be trying to add together <code>ONE(10)</code> and <code>ONE(-10)</code>, which would result in an error since we do not have an addition operator defined on these types.</p>
<p>A variable will match any pattern, so you can use one as a default case. I prefer to use the <code>.</code> variable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">h &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="dv">1</span> -&gt;<span class="st"> </span><span class="dv">1</span>, <span class="dv">13</span> -&gt;<span class="st"> </span><span class="dv">13</span>, . -&gt;<span class="st"> </span><span class="dv">24</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">h</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; [1] 24</span></a></code></pre></div>
<p>When you define function constructors, you can give the arguments types. You do this by adding <code>:</code> and a type name to the argument. For example, we could define</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">one_or_two <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ONE</span>(x <span class="op">:</span><span class="st"> </span>numeric) <span class="op">|</span><span class="st"> </span><span class="kw">TWO</span>(x <span class="op">:</span><span class="st"> </span>numeric, y <span class="op">:</span><span class="st"> </span>numeric)</a></code></pre></div>
<p>We would now get an error if the arguments we provide to the constructors were not <code>numeric</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">ONE</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; ONE(x = 1)</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">ONE</span>(<span class="st">"foo"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; Error in ONE(x = "foo"): The argument x should be of type numeric.</span></a></code></pre></div>
<p>Constructors and pattern matching becomes even more powerful when you start to define recursive data structures. You can, for example, define a binary tree like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">tree <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">L</span>(elm <span class="op">:</span><span class="st"> </span>numeric) <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left <span class="op">:</span><span class="st"> </span>tree, right <span class="op">:</span><span class="st"> </span>tree)</a></code></pre></div>
<p>You can then write a very succinct depth first traversal that collects the leaves of such a tree like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    <span class="kw">L</span>(v) -&gt;<span class="st"> </span>v, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left,right) -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw">f</span>(left), <span class="kw">f</span>(right))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw">L</span>(<span class="dv">1</span>),<span class="kw">L</span>(<span class="dv">2</span>)), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw">L</span>(<span class="dv">3</span>),<span class="kw">L</span>(<span class="dv">4</span>)),<span class="kw">L</span>(<span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">f</span>(x)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; [1] 1 2 3 4 5</span></a></code></pre></div>
<div id="binding-local-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#binding-local-variables" class="anchor"></a>Binding local variables</h3>
<p>You can also assign to variables in the current namespace using subscripting on the special object <code>bind</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">bind[a,b] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">a</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">b</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>With the <code>bind</code> object, you can match against patterns, as with the <code>case_func</code> function, and matched variables will be added to the namespace where you invoke subscripting on <code>bind</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">x</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt; T(left = T(left = L(elm = 1), right = L(elm = 2)), right = T(left = T(left = L(elm = 3), right = L(elm = 4)), right = L(elm = 5)))</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">bind[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left, right)] &lt;-<span class="st"> </span>x</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">left</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; T(left = L(elm = 1), right = L(elm = 2))</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">right</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; T(left = T(left = L(elm = 3), right = L(elm = 4)), right = L(elm = 5))</span></a></code></pre></div>
</div>
<div id="testing-more-than-one-pattern" class="section level3">
<h3 class="hasAnchor">
<a href="#testing-more-than-one-pattern" class="anchor"></a>Testing more than one pattern</h3>
<p>If you want to test more than one pattern at a time you can create a data type for tuples, e.g.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">tuples <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">..</span>(first, second) <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dots">...</a></span>(first, second, third)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">f &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(<span class="kw">..</span>(.,.) -&gt;<span class="st"> </span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dots">...</a></span>(.,.,.) -&gt;<span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">f</span>(<span class="kw">..</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">f</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dots">...</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; [1] 3</span></a></code></pre></div>
<p>For more examples, see below.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the stable version of pmatch from CRAN using</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"pmatch"</span>)</a></code></pre></div>
<p>You can install the development version pmatch from github with:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"mailund/pmatch"</span>)</a></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>To show how the <code>pmatch</code> package can be used, I will use three data structures that I have implemented without <code>pmatch</code> in my book on <a href="http://amzn.to/2Eb4RKK"><em>Functional Data Structures in R</em></a>: linked lists, plain search trees, and red-black search trees.</p>
<p>To run the examples below, you will need to use the <code>magrittr</code> package for the pipe operator, <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a></code></pre></div>
<div id="linked-lists" class="section level3">
<h3 class="hasAnchor">
<a href="#linked-lists" class="anchor"></a>Linked lists</h3>
<p>The <code>list</code> type in R is allocated to have a certain size when it is created, and changing the size of <code>list</code> objects involve creating a new object and moving all the elements from the old object to the new. This is a linear time operation, so growing lists usually lead to quadratic running times. With linked lists, on the other hand, you can prepend elements in constant time–at the cost of linear time random access.</p>
<p>You can implement a linked list using <code>list</code> objects. You simply construct a list that contains two elements, the head of the linked lists–traditionally called <code>car</code>–and the tail of the list–another linked list, traditionally named <code>cdr</code>. You need a special representation for empty lists, and a natural choice is <code>NULL</code>. With <code>pmatch</code> we will use a constant instead, though, so we can pattern match on empty lists.</p>
<p>We can define a linked list using the <code>pmatch</code> syntax like this:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">linked_list <span class="op">:</span><span class="er">=</span><span class="st"> </span>NIL <span class="op">|</span><span class="st"> </span><span class="kw">CONS</span>(car, cdr <span class="op">:</span><span class="st"> </span>linked_list)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">lst &lt;-<span class="st"> </span><span class="kw">CONS</span>(<span class="dv">1</span>, <span class="kw">CONS</span>(<span class="dv">2</span>, <span class="kw">CONS</span>(<span class="dv">3</span>, NIL)))</a></code></pre></div>
<p>Although R doesn’t implement tail recursion optimization, habit forces me to write tail recursive functions. For list functions, this usually means providing an accumulator parameter. Other than that, recursive functions operating on linked lists should simply match on <code>NIL</code> and <code>CONS</code> patterns. Two examples could be computing the length of a list and reversing a list:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">list_length &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(<span class="dt">acc =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">        NIL -&gt;<span class="st"> </span>acc,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">        <span class="kw">CONS</span>(car, cdr) -&gt;<span class="st"> </span><span class="kw">list_length</span>(cdr, acc <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="kw">list_length</span>(lst)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">reverse_list &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(<span class="dt">acc =</span> NIL,</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">        NIL -&gt;<span class="st"> </span>acc,</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">        <span class="kw">CONS</span>(car, cdr) -&gt;<span class="st"> </span><span class="kw">reverse_list</span>(cdr, <span class="kw">CONS</span>(car, acc))</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb21-13" data-line-number="13"></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="kw">reverse_list</span>(lst)</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">#&gt; CONS(car = 3, cdr = CONS(car = 2, cdr = CONS(car = 1, cdr = NIL)))</span></a></code></pre></div>
<p>Translating to and from vectors/<code>list</code> objects is relatively simple. To go from a vector to a linked list, we use <code>NIL</code> and <code>CONS</code>, and to go the other direction we use pattern matching:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">vector_to_list &lt;-<span class="st"> </span><span class="cf">function</span>(vec) purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce_right</a></span>(vec, <span class="op">~</span><span class="st"> </span><span class="kw">CONS</span>(.y, .x), <span class="dt">.init =</span> NIL)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">list_to_vector &lt;-<span class="st"> </span><span class="cf">function</span>(lst) {</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">list_length</span>(lst)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">  v &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="st">"list"</span>, <span class="dt">length =</span> n)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  f &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(i,</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">          NIL -&gt;<span class="st"> </span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">          <span class="kw">CONS</span>(car, cdr) -&gt;<span class="st"> </span>{</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">            v[[i]] &lt;&lt;-<span class="st"> </span>car</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">            <span class="kw">f</span>(cdr, i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">            }</a>
<a class="sourceLine" id="cb22-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb22-13" data-line-number="13">  <span class="kw">f</span>(lst, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-14" data-line-number="14">  v <span class="op">%&gt;%</span><span class="st"> </span>unlist</a>
<a class="sourceLine" id="cb22-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb22-16" data-line-number="16"></a>
<a class="sourceLine" id="cb22-17" data-line-number="17">lst &lt;-<span class="st"> </span><span class="kw">vector_to_list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="kw">list_length</span>(lst)</a>
<a class="sourceLine" id="cb22-19" data-line-number="19"><span class="co">#&gt; [1] 5</span></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="kw">list_to_vector</span>(lst)</a>
<a class="sourceLine" id="cb22-21" data-line-number="21"><span class="co">#&gt; [1] 1 2 3 4 5</span></a>
<a class="sourceLine" id="cb22-22" data-line-number="22">lst <span class="op">%&gt;%</span><span class="st"> </span>reverse_list <span class="op">%&gt;%</span><span class="st"> </span>list_to_vector</a>
<a class="sourceLine" id="cb22-23" data-line-number="23"><span class="co">#&gt; [1] 5 4 3 2 1</span></a></code></pre></div>
</div>
<div id="search-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#search-trees" class="anchor"></a>Search trees</h3>
<p>Search trees are binary trees that holds values in all inner nodes and satisfy the invariant that all values in a left subtree are smaller than the value in an inner node, and all values in the right subtree are larger.</p>
<p>We can define a search tree like this:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">search_tree <span class="op">:</span><span class="er">=</span><span class="st"> </span>E <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left <span class="op">:</span><span class="st"> </span>search_tree, value, right <span class="op">:</span><span class="st"> </span>search_tree)</a></code></pre></div>
<p>Here, we use an empty tree, <code>E</code>, for leaves. We only store values in inner nodes, created with the constructor <code>T</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">tree &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(E,<span class="dv">1</span>,E), <span class="dv">3</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(E,<span class="dv">4</span>,E))</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">tree</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt; T(left = T(left = E, value = 1, right = E), value = 3, right = T(left = E, value = 4, right = E))</span></a></code></pre></div>
<p>Because of the invariant, we know where values should be found if they are in a tree. We can look at the value in the root of a subtree. If it is larger than the value we are searching for, we need to search to the left. If it is smaller, we need to search to the right. Otherwise, it must be equal to the value. If we reach an empty tree in this search, then we know the value is no the tree.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">member &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(x,</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">        E -&gt;<span class="st"> </span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left, val, right) -&gt;<span class="st"> </span>{</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">          <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span>val) <span class="kw">member</span>(left, x)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">          <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>val) <span class="kw">member</span>(right, x)</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">          <span class="cf">else</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7">        }</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="kw">member</span>(tree, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="kw">member</span>(tree, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="kw">member</span>(tree, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="kw">member</span>(tree, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="kw">member</span>(tree, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>Since data in R, in general, are immutable, we cannot update search trees. We can, however, create copies with updated structure, and because R implements “copy-on-write”, this is an efficient way of updating the structure of data we work on. If we insert elements into a search tree, what we will really be doing is to create a new tree that holds all the values the old tree held plus the new values. If the value is already in the old tree we do not add it again, but we will be returning a new tree. We create the new tree in a recursion. Whenever we call recursively, we create a new inner node that will contain one subtree that is an exact copy of one of the subtrees from the old tree–shared with the old tree so no actual copying takes place–and one subtree that is created in the recursive insertion. The recursion goes left or right using the same logic as in the <code>member</code> function. If we find that the element is already in the tree, we terminate the recursion with the tree that contains the value. If we reach an empty tree, the element was not in the old tree, but we have found the place where it should be in the new tree, so we create an inner tree with two empty subtrees and the value.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">insert &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(x,</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">        E -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(E, x, E),</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left, val, right) -&gt;</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="st">          </span><span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span>val)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(<span class="kw">insert</span>(left, x), val, right)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">          <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>val)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left, val, <span class="kw">insert</span>(right, x))</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">          <span class="cf">else</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(left, x, right)</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"></a>
<a class="sourceLine" id="cb26-12" data-line-number="12">tree &lt;-<span class="st"> </span>E</a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>))</a>
<a class="sourceLine" id="cb26-14" data-line-number="14">  tree &lt;-<span class="st"> </span><span class="kw">insert</span>(tree, i)</a>
<a class="sourceLine" id="cb26-15" data-line-number="15"></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(i, <span class="st">" : "</span>, <span class="kw">member</span>(tree, i), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb26-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">#&gt; 1  :  FALSE </span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">#&gt; 2  :  TRUE </span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">#&gt; 3  :  TRUE </span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">#&gt; 4  :  TRUE </span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">#&gt; 5  :  FALSE </span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">#&gt; 6  :  FALSE</span></a></code></pre></div>
</div>
<div id="red-black-search-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#red-black-search-trees" class="anchor"></a>Red-black search trees</h3>
<p>The worst-case time usage for both of these functions is proportional to the depth of the tree, and that can be linear in the number of elements stored in the tree. If we keep the tree balanced, though, the time is reduced to logarithmic in the size of the tree. A classical data structure for keeping search trees balanced is so-called <em>red-black</em> search trees. Implementing these using pointer or reference manipulation in languages such as C/C++ or Java can be quite challenging, but in a functional language, balancing such trees is a simple matter of transforming trees based on local structure.</p>
<p>Red-black search trees are binary search trees where each tree has a colour associated, either red or black. We can define colours using constant constructors and define a red-black search tree by extending the plain search tree:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">colour <span class="op">:</span><span class="er">=</span><span class="st"> </span>R <span class="op">|</span><span class="st"> </span>B</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">rb_tree <span class="op">:</span><span class="er">=</span><span class="st"> </span>E <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col <span class="op">:</span><span class="st"> </span>colour, left <span class="op">:</span><span class="st"> </span>rb_tree, value, right <span class="op">:</span><span class="st"> </span>rb_tree)</a></code></pre></div>
<p>Except for including the colour in the pattern matching, the <code>member</code> function for this data structure is the same as for the plain search tree.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">member &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(x,</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">        E -&gt;<span class="st"> </span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col, left, val, right) -&gt;<span class="st"> </span>{</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">          <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span>val) <span class="kw">member</span>(left, x)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">          <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>val) <span class="kw">member</span>(right, x)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">          <span class="cf">else</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">        }</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb28-9" data-line-number="9"></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">tree &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R, E, <span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B, E, <span class="dv">5</span>, E))</a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(i, <span class="st">" : "</span>, <span class="kw">member</span>(tree, i), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb28-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="co">#&gt; 1  :  FALSE </span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="co">#&gt; 2  :  TRUE </span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co">#&gt; 3  :  FALSE </span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="co">#&gt; 4  :  FALSE </span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="co">#&gt; 5  :  TRUE </span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="co">#&gt; 6  :  FALSE</span></a></code></pre></div>
<p>Red-black search trees are kept balanced because we enforce these two invariants:</p>
<ol style="list-style-type: decimal">
<li>No red node has a red parent.</li>
<li>Every path from the root to a leaf has the same number of black nodes.</li>
</ol>
<p>If every path from root to a leaf has the same number of black nodes, then the tree is perfectly balanced if we ignored the red nodes. Since no red node has a red parent, the longest path, when red nodes are considered, can be no longer than twice the length of the shortest path.</p>
<p>These invariants can be guaranteed by always inserting new values in red leaves, potentially invalidating the first invariant, and then rebalancing all sub-trees that invalidate this invariant, and at the end setting the root to be black. The rebalancing is done when returning from the recursive insertion calls that otherwise work as insertion in the plain search tree.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">insert_rec &lt;-<span class="st"> </span><span class="kw"><a href="reference/case_func.html">case_func</a></span>(x,</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">        E -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R, E, x, E),</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col, left, val, right) -&gt;<span class="st"> </span>{</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">          <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span>val)</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">            <span class="kw">balance</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col, <span class="kw">insert_rec</span>(left, x), val, right))</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">          <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>val)</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">            <span class="kw">balance</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col, left, val, <span class="kw">insert_rec</span>(right, x)))</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">          <span class="cf">else</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9">            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(col, left, x, right) <span class="co"># already here</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">        }</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">insert &lt;-<span class="st"> </span><span class="cf">function</span>(tree, x) {</a>
<a class="sourceLine" id="cb29-13" data-line-number="13">  tree &lt;-<span class="st"> </span><span class="kw">insert_rec</span>(tree, x)</a>
<a class="sourceLine" id="cb29-14" data-line-number="14">  tree<span class="op">$</span>col &lt;-<span class="st"> </span>B</a>
<a class="sourceLine" id="cb29-15" data-line-number="15">  tree</a>
<a class="sourceLine" id="cb29-16" data-line-number="16">}</a></code></pre></div>
<p>The transformation rules for the <code>balance</code> function are shown in the figure below:</p>
<p><img src="http://users-cs.au.dk/mailund/RBT-transformations.png"></p>
<p>Every time we see one of the trees around the edges, we must transform it into the tree in the middle. We can implement these transformations as simple as this:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">balance &lt;-<span class="st"> </span><span class="cf">function</span>(tree) {</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">  <span class="kw">cases</span>(tree,</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,a,x,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,b,y,c)),z,d) -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,b),y,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,c,z,d)),</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,a,x,b),y,c),z,d) -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,b),y,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,c,z,d)),</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,b,y,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,c,z,d))) -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,b),y,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,c,z,d)),</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,b,y,c),z,d)) -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(R,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,a,x,b),y,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/logical">T</a></span>(B,c,z,d)),</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">        otherwise -&gt;<span class="st"> </span>tree)</a>
<a class="sourceLine" id="cb30-8" data-line-number="8">}</a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=pmatch">https://​cloud.r-project.org/​package=pmatch</a>
</li>
<li>Browse source code at <br><a href="https://github.com/mailund/pmatch">https://​github.com/​mailund/​pmatch</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mailund/pmatch/issues">https://​github.com/​mailund/​pmatch/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing pmatch</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Thomas Mailund <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.gnu.org/licenses/gpl-3.0.en.html"><img src="https://img.shields.io/badge/licence-GPL--3-blue.svg" alt="Licence"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="http://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
<li><a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active"></a></li>
<li><a href="/commits/master"><img src="https://img.shields.io/badge/last%20change-2018--12--19-green.svg" alt="Last-changedate"></a></li>
<li><a href="commits/master"><img src="https://img.shields.io/badge/Package%20version-0.1.4.9000-orange.svg?style=flat-square" alt="packageversion"></a></li>
<li><a href="https://travis-ci.org/mailund/pmatch"><img src="http://travis-ci.org/mailund/pmatch.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/mailund/pmatch"><img src="http://ci.appveyor.com/api/projects/status/wvyqe7bfp4a2rm77?svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/mailund/pmatch?branch=master"><img src="http://img.shields.io/codecov/c/github/mailund/pmatch/master.svg" alt="Coverage Status"></a></li>
<li><a href="https://coveralls.io/github/mailund/pmatch?branch=master"><img src="http://coveralls.io/repos/github/mailund/pmatch/badge.svg?branch=master" alt="Coverage Status"></a></li>
<li><a href="https://cran.r-project.org/package=pmatch"><img src="http://www.r-pkg.org/badges/version/pmatch" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=pmatch"><img src="http://cranlogs.r-pkg.org/badges/grand-total/pmatch" alt="CRAN downloads"></a></li>
<li><a href="https://cran.r-project.org/"><img src="https://img.shields.io/badge/R-%E2%89%A53.3-blue.svg" alt="minimal R version"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas Mailund.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
