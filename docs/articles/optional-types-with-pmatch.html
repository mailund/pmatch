<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>“Optional” Types with pmatch • pmatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="“Optional” Types with pmatch">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started-with-pmatch-.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started-with-pmatch-.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/huffman-coding.html">Huffman coding</a>
    </li>
    <li>
      <a href="../articles/optional-types-with-pmatch.html">Optional types</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/ThomasMailund">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/mailund/pmatch">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>“Optional” Types with pmatch</h1>
                        <h4 class="author">Thomas Mailund</h4>
            
            <h4 class="date">2018-12-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mailund/pmatch/blob/master/vignettes/optional-types-with-pmatch.Rmd"><code>vignettes/optional-types-with-pmatch.Rmd</code></a></small>
      <div class="hidden name"><code>optional-types-with-pmatch.Rmd</code></div>

    </div>

    
    
<p>Some programming languages, e.g. Swift, have special “optional” types. These are types the represent elements that either contain a value of some other type or contain nothing at all. It is a way of computing with the possibility that some operations cannot be done and then propagating that along in the computations.</p>
<p>We can use <code>pmatch</code> to implement something similar in R. I will use three types instead of two, to represent no value, <code>NONE</code>, some value, <code>VALUE(val)</code>, or some error <code>ERROR(err)</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">OPT <span class="op">:</span><span class="er">=</span><span class="st"> </span>NONE <span class="op">|</span><span class="st"> </span><span class="kw">VALUE</span>(val) <span class="op">|</span><span class="st"> </span><span class="kw">ERROR</span>(err)</a></code></pre></div>
<p>We can now define a function that catches exceptions and translate them into <code>ERROR()</code> objects:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">try &lt;-<span class="st"> </span><span class="cf">function</span>(expr) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">enquo</a></span>(expr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/conditions">tryCatch</a></span>(<span class="kw">VALUE</span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(expr)), </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">             <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="kw">ERROR</span>(e))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">}</a></code></pre></div>
<p>With this function the control flow when we want to compute something that might go wrong can be made a bit simpler. We no longer need a callback error handler; instead we can inspect the value returned by <code>try</code> in a <code>case_func</code> call:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">unpack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="kw">VALUE</span>(val) -&gt;<span class="st"> </span>val,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="kw">ERROR</span>(err) -&gt;<span class="st"> </span>err,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">unpack</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/try">try</a></span>(<span class="dv">42</span>))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [1] 42</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">unpack</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/try">try</a></span>(x <span class="op">+</span><span class="st"> </span><span class="dv">42</span>)) <span class="co"># x isn't defined...</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; &lt;simpleError in rlang::eval_tidy(expr): object 'x' not found&gt;</span></a></code></pre></div>
<div id="computing-with-optional-values" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-with-optional-values" class="anchor"></a>Computing with optional values</h2>
<p>Computing on optional values is more interesting if we can make it relatively transparent that this is what we are doing. For arithmetic expressions we can do this by defining operations on these types. A sensible way is to return errors if we see those, then <code>NONE</code> if we see one of those, and otherwise use <code>VALUE</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">pair <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">..</span>(first, second)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">wrap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">        .Generic, <span class="co"># underlying generic</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">        <span class="kw">..</span>(<span class="kw">ERROR</span>(err), .)        -&gt;<span class="st"> </span><span class="kw">ERROR</span>(err),</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">        <span class="kw">..</span>(., <span class="kw">ERROR</span>(err))        -&gt;<span class="st"> </span><span class="kw">ERROR</span>(err),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">        <span class="kw">..</span>(NONE, .)              -&gt;<span class="st"> </span>NONE,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">        <span class="kw">..</span>(., NONE)              -&gt;<span class="st"> </span>NONE,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">        <span class="kw">..</span>(<span class="kw">VALUE</span>(v1), <span class="kw">VALUE</span>(v2)) -&gt;<span class="st"> </span><span class="kw">VALUE</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(.Generic, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(v1, v2))),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">        <span class="kw">..</span>(<span class="kw">VALUE</span>(v1), v2)        -&gt;<span class="st"> </span><span class="kw">VALUE</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(.Generic, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(v1, v2))),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">        <span class="kw">..</span>(v1, <span class="kw">VALUE</span>(v2))        -&gt;<span class="st"> </span><span class="kw">VALUE</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(.Generic, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(v1, v2)))</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">Ops.OPT &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) <span class="kw">wrap</span>(<span class="kw">..</span>(x, y), .Generic)</a></code></pre></div>
<p>The last two cases here handles when we combine an optional value with a value from the underlying type. Because of the last two cases we do not need to explicitly translate a value into a <code>VALUE()</code>. With this group function defined we can use optional values in expressions.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">VALUE</span>(<span class="dv">12</span>) <span class="op">+</span><span class="st"> </span><span class="kw">VALUE</span>(<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; VALUE(val = 18)</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">NONE <span class="op">+</span><span class="st"> </span><span class="kw">VALUE</span>(<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; NONE</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">ERROR</span>(<span class="st">"foo"</span>) <span class="op">+</span><span class="st"> </span>NONE</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; ERROR(err = foo)</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="kw">VALUE</span>(<span class="dv">12</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ERROR</span>(<span class="st">"bar"</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; ERROR(err = bar)</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="kw">VALUE</span>(<span class="dv">12</span>) <span class="op">+</span><span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; VALUE(val = 24)</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="dv">12</span> <span class="op">+</span><span class="st"> </span>NONE</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; NONE</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="dv">12</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/try">try</a></span>(<span class="dv">42</span> <span class="op">+</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; ERROR(err = Error in rlang::eval_tidy(expr): object 'x' not found</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; )</span></a></code></pre></div>
<p>For mathematical functions, such as <code>log</code> or <code>exp</code>, we can also define versions for optional types:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">Math.OPT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    <span class="kw">ERROR</span>(err) -&gt;<span class="st"> </span><span class="kw">ERROR</span>(err),</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    NONE       -&gt;<span class="st"> </span>NONE,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="kw">VALUE</span>(v)   -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(.Generic, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(x)),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    v          -&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(.Generic, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(x))</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">)</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="kw">ERROR</span>(<span class="st">"foo"</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; ERROR(err = foo)</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(NONE)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; NONE</span></a></code></pre></div>
</div>
<div id="function-calls" class="section level2">
<h2 class="hasAnchor">
<a href="#function-calls" class="anchor"></a>Function calls</h2>
<p>Arithmetic is one thing, but we are probably more likely to use optional values for more complex computations? We can wrap expressions in a function to propagate options:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">to_val &lt;-<span class="st"> </span><span class="kw"><a href="../reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    escape,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="kw">ERROR</span>(err) -&gt;<span class="st"> </span><span class="kw">escape</span>(<span class="kw">ERROR</span>(err)),</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    NONE       -&gt;<span class="st"> </span><span class="kw">escape</span>(NONE),</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="kw">VALUE</span>(val) -&gt;<span class="st"> </span>val,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    val        -&gt;<span class="st"> </span>val</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">to_opt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/case_func.html">case_func</a></span>(</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    escape,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    <span class="kw">ERROR</span>(err) -&gt;<span class="st"> </span><span class="kw">ERROR</span>(err),</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    NONE       -&gt;<span class="st"> </span>NONE,</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="kw">VALUE</span>(val) -&gt;<span class="st"> </span><span class="kw">VALUE</span>(val),</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    val        -&gt;<span class="st"> </span><span class="kw">VALUE</span>(val)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15"></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">with_values &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    optionals &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">enquos</a></span>(...)</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    n &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(optionals)</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">    body &lt;-<span class="st"> </span>optionals[[n]]</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">    optionals &lt;-<span class="st"> </span>optionals[<span class="op">-</span>n]</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">    ev &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/env.html">child_env</a></span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/get_env.html">get_env</a></span>(body))</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb9-23" data-line-number="23">    try_ &lt;-<span class="st"> </span><span class="cf">function</span>(q, ev) {</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/warning">suppressWarnings</a></span>(</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/conditions">tryCatch</a></span>(<span class="kw">VALUE</span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(q, <span class="dt">data =</span> ev)), </a>
<a class="sourceLine" id="cb9-26" data-line-number="26">                 <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="kw">ERROR</span>(e))</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">        )</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">    }</a>
<a class="sourceLine" id="cb9-29" data-line-number="29"></a>
<a class="sourceLine" id="cb9-30" data-line-number="30">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/callCC">callCC</a></span>(<span class="cf">function</span>(escape) {</a>
<a class="sourceLine" id="cb9-31" data-line-number="31">        <span class="cf">for</span> (q <span class="cf">in</span> optionals) {</a>
<a class="sourceLine" id="cb9-32" data-line-number="32">            <span class="cf">if</span> (rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quosure.html">quo_is_symbol</a></span>(q)) {</a>
<a class="sourceLine" id="cb9-33" data-line-number="33">                var_name &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(q[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb9-34" data-line-number="34">                ev[[var_name]] &lt;-<span class="st"> </span><span class="kw">to_val</span>(</a>
<a class="sourceLine" id="cb9-35" data-line-number="35">                    rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(q, <span class="dt">data =</span> ev), </a>
<a class="sourceLine" id="cb9-36" data-line-number="36">                    escape</a>
<a class="sourceLine" id="cb9-37" data-line-number="37">                )</a>
<a class="sourceLine" id="cb9-38" data-line-number="38">                </a>
<a class="sourceLine" id="cb9-39" data-line-number="39">            } <span class="cf">else</span> <span class="cf">if</span> (rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quosure.html">quo_is_call</a></span>(q)) {</a>
<a class="sourceLine" id="cb9-40" data-line-number="40">                <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stopifnot">stopifnot</a></span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/call_name.html">call_name</a></span>(q) <span class="op">==</span><span class="st"> "&lt;-"</span> <span class="op">||</span></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="st">                          </span>rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/call_name.html">call_name</a></span>(q) <span class="op">==</span><span class="st"> "=="</span>)</a>
<a class="sourceLine" id="cb9-42" data-line-number="42">                var_name &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(q[[<span class="dv">2</span>]][[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb9-43" data-line-number="43">                val_expr &lt;-<span class="st"> </span>q[[<span class="dv">2</span>]][[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb9-44" data-line-number="44">                ev[[var_name]] &lt;-<span class="st"> </span><span class="kw">to_val</span>(</a>
<a class="sourceLine" id="cb9-45" data-line-number="45">                    <span class="kw">try_</span>(val_expr, ev),</a>
<a class="sourceLine" id="cb9-46" data-line-number="46">                    escape</a>
<a class="sourceLine" id="cb9-47" data-line-number="47">                )</a>
<a class="sourceLine" id="cb9-48" data-line-number="48">                </a>
<a class="sourceLine" id="cb9-49" data-line-number="49">            }  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb9-50" data-line-number="50">                <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop</a></span>(<span class="st">"Optional values must be names of assignments."</span>)</a>
<a class="sourceLine" id="cb9-51" data-line-number="51">            }</a>
<a class="sourceLine" id="cb9-52" data-line-number="52">        }</a>
<a class="sourceLine" id="cb9-53" data-line-number="53">        <span class="kw">to_opt</span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(body, <span class="dt">data =</span> ev))</a>
<a class="sourceLine" id="cb9-54" data-line-number="54">    })</a>
<a class="sourceLine" id="cb9-55" data-line-number="55">    </a>
<a class="sourceLine" id="cb9-56" data-line-number="56">}</a>
<a class="sourceLine" id="cb9-57" data-line-number="57"></a>
<a class="sourceLine" id="cb9-58" data-line-number="58">x &lt;-<span class="st"> </span><span class="kw">VALUE</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-59" data-line-number="59">y &lt;-<span class="st"> </span><span class="kw">VALUE</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-60" data-line-number="60"><span class="kw">with_values</span>(</a>
<a class="sourceLine" id="cb9-61" data-line-number="61">    x, y,</a>
<a class="sourceLine" id="cb9-62" data-line-number="62">    z &lt;-<span class="st"> </span><span class="kw">VALUE</span>(<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb9-63" data-line-number="63">    w &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z,</a>
<a class="sourceLine" id="cb9-64" data-line-number="64">    (w <span class="op">-</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>y) <span class="op">/</span><span class="st"> </span>z</a>
<a class="sourceLine" id="cb9-65" data-line-number="65">)</a>
<a class="sourceLine" id="cb9-66" data-line-number="66"><span class="co">#&gt; VALUE(val = 1)</span></a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">with_values</span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    f &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">file</a></span>(<span class="st">"no such file"</span>, <span class="st">"r"</span>),</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(f)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; ERROR(err = Error in file("no such file", "r"): cannot open the connection</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; )</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#computing-with-optional-values">Computing with optional values</a></li>
      <li><a href="#function-calls">Function calls</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas Mailund.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
